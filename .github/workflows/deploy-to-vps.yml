# name: Deploy to VPS

# on:
#   pull_request:
#     types: [closed]
#     branches: [prod]

# env:
#   REGISTRY: reg.ult.vn
#   IMAGE_NAME: digitop/ps-api
#   DEPLOY_PATH: /opt/deployments/ps.upfile.best.39023

# jobs:
#   deploy:
#     if: github.event.pull_request.merged == true
#     runs-on: self-hosted

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       # - name: Login to Docker Registry
#       #   uses: docker/login-action@v3
#       #   with:
#       #     registry: ${{ env.REGISTRY }}
#       #     username: ${{ secrets.REG_ULT_VN_USERNAME }}
#       #     password: ${{ secrets.REG_ULT_VN_PASSWORD }}

#       - name: Build and Push Docker Image
#         run: |
#           echo "Building Docker image..."
#           # -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest \

#           sudo docker build -f Dockerfile.prod \
#             -t ${{ env.IMAGE_NAME }}:latest \
#             .

#           # echo "Pushing to registry..."
#           # sudo docker push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest

#           echo "Cleaning up build cache..."
#           sudo docker image prune -f

#       - name: Deploy to VPS
#         run: |
#           echo "Deploying to VPS..."
#           cd ${{ env.DEPLOY_PATH }}

#           # sudo docker compose up -d --pull always
#           sudo docker compose up -d --force-recreate
#           echo "âœ… Deployment completed successfully!"
#           sudo docker compose ps
